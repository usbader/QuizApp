<?php require('includes/config.php');

if(isset($_POST['submit'])){
	//very basic validation
	if(strlen($_POST['username']) < 3){
		$error[] = 'Username is too short.';
	} else {
		$stmt = $db->prepare('SELECT username FROM members WHERE username = :username');
		$stmt->execute(array(':username' => $_POST['username']));
		$row = $stmt->fetch(PDO::FETCH_ASSOC);
		if(!empty($row['username'])){
			$error[] = 'Username provided is already in use.';
		}
	}
	if(strlen($_POST['password']) < 3){
		$error[] = 'Password is too short.';
	}
	if(strlen($_POST['passwordConfirm']) < 3){
		$error[] = 'Confirm password is too short.';
	}
	if($_POST['password'] != $_POST['passwordConfirm']){
		$error[] = 'Passwords do not match.';
	}
	//email validation
	if(!filter_var($_POST['email'], FILTER_VALIDATE_EMAIL)){
	    $error[] = 'Please enter a valid email address';
	} else {
		$stmt = $db->prepare('SELECT email FROM members WHERE email = :email');
		$stmt->execute(array(':email' => $_POST['email']));
		$row = $stmt->fetch(PDO::FETCH_ASSOC);
		if(!empty($row['email'])){
			$error[] = 'Email provided is already in use.';
		}
	}
	//if no errors have been created carry on
	if(!isset($error)){
		//hash the password
		$hashedpassword = $user->password_hash($_POST['password'], PASSWORD_BCRYPT);
		//create the activasion code
		$activasion = md5(uniqid(rand(),true));
		try {
			//insert into database with a prepared statement
			$stmt = $db->prepare('INSERT INTO members (username,password,email,active) VALUES (:username, :password, :email, :active)');
			$stmt->execute(array(
				':username' => $_POST['username'],
				':password' => $hashedpassword,
				':email' => $_POST['email'],
				':active' => $activasion
			));
			$id = $db->lastInsertId('memberID');
			//send email
			$to = $_POST['email'];
			$subject = "Registration Confirmation";
			$body = "<p>Thank you for registering at demo site.</p>
			<p>To activate your account, please click on this link: <a href='".DIR."activate.php?x=$id&y=$activasion'>".DIR."activate.php?x=$id&y=$activasion</a></p>
			<p>Regards Site Admin</p>";
			$mail = new Mail();
			$mail->setFrom(SITEEMAIL);
			$mail->addAddress($to);
			$mail->subject($subject);
			$mail->body($body);
			$mail->send();
			//redirect to index page
			header('Location: index.php?action=joined');
			exit;
		//else catch the exception and show the error.
		} catch(PDOException $e) {
		    $error[] = $e->getMessage();
		}
	}
}
//define page title
$title = 'My Quiz';
//include header template
?>

<html>
<head>
	<!--Import Google Icon Font-->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<!--Import materialize.css-->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css">
	<!--Let browser know website is optimized for mobile-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title><?php if(isset($title)){ echo $title; }?></title>

	<!-- CSS  -->

	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js"></script>
	<script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.0.0/lodash.min.js"></script>

	<!--Import Google Icon Font-->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<!--Import materialize.css-->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css">

	<!--Import stylesheet for Leaflet to work-->
	<script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.0.0/lodash.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<link type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/redmond/jquery-ui.css" rel="stylesheet" />
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.1/modernizr.min.js"></script>
	<script src="//netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>



</head>

<style>
	html {
		background-color: papayawhip;
	}
</style>

<style type="text/css">
	#abgne_float_ad {
		display: none;
		position: absolute;
	}
	div.bigDiv {
		height: 500px;
	}
</style>


<style type="text/css">
	#slide {
		position: relative;
	}

	#slide1 {
		bottom: 0;
		min-height: 80px;
		left: 0;
		position: absolute;
		width: 100%;
		z-index: 2;
	}
</style>

<body>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js"></script>

<header>
<nav class="nav-wrapper grey darken-3 " role="navigation" style="opacity: 0.7" id="nav-bar">
	<div class="nav-wrapper container">
		<a id="logo-container" href="#" class="brand-logo">My Quiz</a>
		<ul class="right hide-on-med-and-down">
			<li><a href="teacher/index.html">Teacher</a></li>
			<li><a href="student/index.html">Student</a></li>
			<li><a href="admin/index.html">Admin</a></li>
			<li><a href="#" onclick="login()">Log in</a></li>
			<li><a href="#" ">Register</a></li>
		</ul>
	</div>
</nav>

<div id="slide" class="slider" style="z-index: 100 ">

	<ul class="slides">
		<li>
			<img src="images/slide1.jpg">
			<div id="slide1" class="caption center-align">
				<h3>Welcome to My Quiz!</h3>
				<h5 class="light grey-text text-lighten-3">This is a realy convient app for both student and teacher.</h5>
			</div>
		</li>
		<li>
			<img src="images/slide3.jpg">
			<div id="slide2" class="caption left-align">
				<h3>Welcome to My Quiz!</h3>
				<h5 class="light grey-text text-lighten-3">For Student, you can easily take test online without attending school!</h5>
			</div>
		</li>
		<li>
			<img src="images/slide2.jpg">
			<div id="slide3" class="caption right-align">
				<h3>Welcome to My Quiz!</h3>
				<h5 class="light grey-text text-lighten-3">For Teacher,you can easily give a quiz online.</h5>
			</div>
		</li>
	</ul>
</div>
</header>




<main>


<div class="container">
	<div class="section">

		<!--   Icon Section   -->
		<div class="row">
			<div class="col s12 m6">
				<div class="icon-block">
					<h2 class="center grey-text"><i class="material-icons">info</i></h2>
					<h5 class="center">About</h5>
					<p class="light">
						Get rid of your traditional quizing environment, let us provide you a more convinent quizing environment. Try our MyQuiz app, convinent, fast, brilliant.
					</p>
				</div>
			</div>
			<div class="col s12 m6">
				<div class="icon-block">
					<h2 class="center grey-text"><i class="material-icons">stars</i></h2>
					<h5 class="center">How it works</h5>
					<p class="light">
						We offer a pretty easy-using quiz app for teahers who are tired of the traditional testing method. Save your time on gathering the tests, grading the tests, answering students questions. With MyQuiz, all these things can be done online.
					</p>
				</div>
			</div>
		</div>
	</div>
</div>

</main>


<script >
	$(document).ready(function(){
		$('.slider').slider({
			indicators: false,
			height: 527,
			interval: 3000});
	});
	$(".button-collapse").sideNav();

    $(document).ready(function(){
      $('.parallax').parallax();
    });
    
function login()
{


}

</script>

<!--<footer class="page-footer" style="background-color: darkgray; opacity:0.6;z-index: 90" >-->
<footer class="page-footer" style="background-color: darkgray; opacity:0.6;z-index: 90;margin-top:0px;" >
	<div class="footer-copyright">
		<div class="container"><center>
			OO team project, Yen-Teh, Bader, Catherine
		</center>
		</div>
	</div>
</footer>

<script>
	$(document).ready(function(){
		$('.slider').slider({
			indicators: false,
			height: 527,
			interval: 3000});
	});
	$(".button-collapse").sideNav();

    $(document).ready(function(){
      $('.parallax').parallax();
    });
    
function login()
{


}

</script>

</body>


</html>

